# Volumes

In this training, you will learn how to persist data generated by your docker container.

>Navigate to the folder `17_volumes` from CLI, before you get started.

## Inspect the Dockerfile and build the Docker image

```bash
cat Dockerfile
```

```bash
docker build -t volumes:1.0.0 .
```

## RW layer

The RW-layer allows the change to persist, until the container is not removed.
Follow below steps to understand this behaviour.  

* Create the container

  ```bash
  docker run -it -d --name rw-layer volumes:1.0.0
  ```

* Print the content of the file

  ```bash
  docker exec -it rw-layer cat /data/file.txt
  ```

* Stop the container

  ```bash
  docker stop rw-layer
  ```

* Restart the container

  ```bash
  docker start rw-layer
  ```

* Print the content of the file again  

  ```bash
  docker exec -it rw-layer cat /data/file.txt
  ```

  >Note that the file contains the timestamps from the first run.

* Remove the container

  ```bash
  docker rm -f rw-layer
  ```

  >Note that all changes are lost now, since the /data/file.txt was residing inside the container.

## Docker-managed volumes

Docker-managed volumes are managed by docker.

* Create the container

  ```bash
  docker run -it -d --name docker-managed-volume -v /data volumes:1.0.0
  ```

* Printout the content of the file

  ```bash
  docker exec -it docker-managed-volume cat /data/file.txt
  ```

* Cleanup all pre-existing volumes

  ```bash
  docker volume prune
  ```

  >Note that Docker will not delete volumes of running containers.

* List all volumes

  ```bash
  docker volume ls
  ```

* Show the details of the volume via `volume inspect`

  ```bash
  docker volume inspect <VOLUME-NAME>
  ```

* Show the details of the volume via `inspect`

  ```bash
  docker inspect docker-managed-volume | grep -A10 Mounts
  ```

* Change the content of the file on the host

  ```bash
  sudo bash -c 'echo text from host >>  <HOST-VOLUME-PATH>/file.txt'
  ```

* Print the content of the file

  ```bash
  docker exec -it docker-managed-volume cat /data/file.txt
  ```

  >Note that your change is available made in previous step.

* Delete the container

  ```bash
  docker rm -f docker-managed-volume 
  ```

* List the volumes

  ```bash
  docker volume ls
  ```

  >Note that the volume is not deleted yet.

* Cleanup all volumes

  ```bash
  docker volume prune
  ```

* Try to print the content of the file

  ```bash
  sudo cat <HOST-VOLUME-PATH>/file.txt
  ```

  >Note that the file does not exist anymore.

## Bind mount volumes

Bind mount volumes let you manage the lifecycle of your data youself.

* Create the container

  ```bash
  docker run -it -d --name bind-mount-volume -v $PWD/data:/data volumes:1.0.0
  ```

* Check the content of the file `file.txt` in the folder `data` in your current directory

  ```bash
  cat data/file.txt
  ```

* List the volumes

  ```bash
  docker volume ls
  ```

  >Bind volume is not managed by docker.

* Delete the container

  ```bash
  docker rm -f bind-mount-volume
  ```

* Cleanup all volumes

  ```bash
  docker volume prune
  ```

* Check the content of the file `file.txt` again

  ```bash
  cat data/file.txt
  ```

  >Since docker is not managing the bind volume, the data file exists.

## Cleanup

* Remove all the images

  ```bash
  docker rmi -f $(docker images -qa)
  ```
